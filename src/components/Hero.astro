---
import OsixLogo3D from './OsixLogo3D.jsx';
interface Props {
  lang?: string;
}

const { lang = 'es' } = Astro.props;
const translations = await import(`../../public/locales/${lang}.json`);
const t = (k: string) => translations.default[k] || k;
---

<section id="home" class="w-full !mb-0 !min-h-[100dvh] !max-h-[100dvh] flex flex-col items-center justify-end py-8 md:py-16 gap-8 overflow-hidden">
  <div class="logo-3d-container">
    <OsixLogo3D client:load />
  </div>

  <div class="flex w-full flex-row max-w-7xl mx-auto px-6 md:px-12 items-end justify-between">
    <div class="flex flex-col w-full md:items-start items-center justify-end gap-8">
      <div class="flex flex-col w-full items-center md:items-start justify-end !text-black text-center md:text-left z-10 hero-title">
        <h1 class="text-2xl sm:text-3xl md:text-5xl font-semibold">
          <span class="block">{t('hero.title.line1')}</span>
          <span class="block mt-1 md:mt-2">{t('hero.title.line2')}</span>
        </h1>
      </div>
      
        <div id="hero-cta-container" class="transform z-10 flex flex-col sm:flex-row gap-4 items-center hero-cta">
          <a href="#services" class="btn-primary btn-arrow w-full sm:w-auto min-w-[160px] justify-center">
            {t('hero.cta.services')}
            <svg class="btn-arrow-icon" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8h10M9 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </a>
          <a href="#contact" class="btn-secondary btn-arrow w-full sm:w-auto min-w-[160px] justify-center" style="border-color: black;">
            {t('hero.cta.contact')}
            <svg class="btn-arrow-icon" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8h10M9 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </a>
        </div>
    </div>  

    <div id="hero-logo-container" class="z-10 hero-logo">
      <img
        src="/full_logo.png"
        alt="OSIX Tech - AI-Powered Software Development"
        class="w-28 sm:w-32 md:w-40 lg:w-[320px] h-auto"
        width="320"
        height="320"
        fetchpriority="high"
      />
    </div>
  </div>

</section>

<style>
  @keyframes bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-8px);
    }
  }

  /* Initial states - hide elements before animation */
  .hero-title, .hero-cta {
    opacity: 0;
    transform: translateY(20px);
  }
  
  .hero-logo {
    opacity: 1;
  }

  .logo-3d-container {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    transform: translate(-50%, -50%) scale(0.3);
    opacity: 0;
    overflow: hidden;
  }

  /* Animation classes - only applied after loading completes */
  body.loading-complete .hero-title {
    animation: fadeIn 1s ease-out 0.2s forwards;
  }

  body.loading-complete .hero-cta {
    animation: fadeIn 1s ease-out 0.8s forwards;
  }

  body.loading-complete .logo-3d-container {
    animation: expandIn 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  @keyframes fadeIn {
    from { 
      opacity: 0; 
      transform: translateY(20px); 
    }
    to { 
      opacity: 1; 
      transform: translateY(0); 
    }
  }
  
  @keyframes fadeInLogo {
    from { 
      opacity: 0; 
    }
    to { 
      opacity: 1; 
    }
  }
  
  @keyframes slideUpLogo {
    from { 
      transform:  translateY(20px); 
    }
    to { 
      transform: translateY(0); 
    }
  }

  @keyframes expandIn {
    from { 
      transform: translate(-50%, -50%) scale(0.2);
      opacity: 0;
    }
    to { 
      transform: translate(-50%, -60%) scale(1);
      opacity: 1;
    }
  }

  /* Hide CTA container on mobile */
  @media (max-width: 780px) {
    #hero-logo-container {
      display: none;
    }
  }

</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll<HTMLAnchorElement>('#hero-cta-container a[href^="#"]').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        if (!targetId) return;
        const targetElement = document.querySelector(targetId) as HTMLElement;
        if (targetElement) {
          const header = document.getElementById('main-header');
          const headerHeight = header ? header.offsetHeight : 0;
          const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - headerHeight;
          smoothScrollTo(targetPosition, 2000);
        }
      });
    });

    function smoothScrollTo(targetPosition: number, duration: number) {
      const startPosition = window.pageYOffset;
      const distance = targetPosition - startPosition;
      let startTime: number | null = null;

      function animation(currentTime: number) {
        if (startTime === null) startTime = currentTime;
        const timeElapsed = currentTime - startTime;
        const progress = Math.min(timeElapsed / duration, 1);
        const ease = easeInOutCubic(progress);

        window.scrollTo(0, startPosition + distance * ease);

        if (timeElapsed < duration) {
          requestAnimationFrame(animation);
        }
      }

      function easeInOutCubic(t: number) {
        return t < 0.5
          ? 4 * t * t * t
          : 1 - Math.pow(-2 * t + 2, 3) / 2;
      }

      requestAnimationFrame(animation);
    }
  });
</script>